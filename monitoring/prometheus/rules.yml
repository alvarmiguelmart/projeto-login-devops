groups:
  - name: alertas_gerais
    interval: 30s
    rules:
    - alert: HighCPUUsage
      expr: sum(rate(container_cpu_usage_seconds_total[5m])) by (pod) > 0.8
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "Alto uso de CPU no pod {{ $labels.pod }}"
        description: "CPU usage > 80% por mais de 5 minutos"
    
    - alert: HighMemoryUsage
      expr: (container_memory_working_set_bytes / container_spec_memory_limit_bytes) > 0.85
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "Alto uso de memória no pod {{ $labels.pod }}"
        description: "Memory usage > 85% por mais de 5 minutos"
    
    - alert: PodDown
      expr: kube_pod_status_phase{phase=~"Failed|Unknown"} > 0
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "Pod {{ $labels.pod }} está com problema"
        description: "O pod está em estado Failed ou Unknown"
    
    - alert: HighErrorRate
      expr: sum(rate(http_requests_total{status=~"5.."}[5m])) / sum(rate(http_requests_total[5m])) > 0.05
      for: 2m
      labels:
        severity: critical
      annotations:
        summary: "Alta taxa de erros HTTP"
        description: "Taxa de erro > 5% nos últimos 5 minutos"
